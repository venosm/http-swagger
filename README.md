# http-swagger

This project is based on [swaggo/http-swagger](https://github.com/swaggo/http-swagger) with enhanced features and improvements.

Default net/http wrapper to automatically generate RESTful API documentation with Swagger 3.0.


[![GoDoc](https://godoc.org/github.com/venosm/http-swagger?status.svg)](https://godoc.org/github.com/venosm/http-swagger)
[![Release](https://img.shields.io/github/release/venosm/http-swagger.svg?style=flat-square)](https://github.com/venosm/http-swagger/releases)

## Usage

### Start using it

1. Add comments to your API source code, [See Declarative Comments Format](https://github.com/venosm/swag#declarative-comments-format).
2. Download [Swag](https://github.com/venosm/swag) for Go by using:
```sh
go install github.com/venosm/swag/cmd/swag@latest
```
To build from source you need [Go](https://golang.org/dl/) (1.17 or newer).

Or download a pre-compiled binary from the [release page](https://github.com/venosm/swag/releases).

3. Run the [Swag](https://github.com/venosm/swag) in your Go project root folder which contains `main.go` file, [Swag](https://github.com/venosm/swag) will parse comments and generate required files(`docs` folder and `docs/doc.go`).
```sh
swag init
```
4. Download [http-swagger](https://github.com/venosm/http-swagger) by using:
```sh
go get -u github.com/venosm/http-swagger
go get -u github.com/venosm/swag-files # swaggo files
```

Import following in your code:
```go
import "github.com/venosm/http-swagger" // http-swagger middleware
```

### Canonical example

Now assume you have implemented a simple api as following:
```go
// A get function which can be called as a REST API endpoint.
// @Summary Show an account
// @Description get string by ID
// @ID get-string-by-int
// @Accept  json
// @Produce  json
// @Param id path int true "Account ID"
// @Success 200 {object} model.Account
// @Failure 400 {object} httputil.HTTPError
// @Failure 404 {object} httputil.HTTPError
// @Failure 500 {object} httputil.HTTPError
// @Router /accounts/{id} [get]
func (c *Controller) ShowAccount(w http.ResponseWriter, r *http.Request) {
    // your code here
}
```

So how to use http-swagger on famous frameworks:

### net/http

Please refer to the [example folder](example)

[embedmd]:# (example/gorilla/main.go go)
```go
package main

import (
	"log"
	"net/http"

	"github.com/gorilla/mux"
	_ "github.com/venosm/http-swagger/example/gorilla/docs" // docs is generated by Swag CLI, you have to import it.
	httpSwagger "github.com/venosm/http-swagger"
)

// @title Swagger Example API
// @version 1.0
// @description This is a sample server Petstore server.
// @termsOfService http://swagger.io/terms/

// @contact.name API Support
// @contact.url http://www.swagger.io/support
// @contact.email support@swagger.io

// @license.name Apache 2.0
// @license.url http://www.apache.org/licenses/LICENSE-2.0.html

// @host petstore.swagger.io
// @BasePath /v2
func main() {
	r := mux.NewRouter()

	r.PathPrefix("/swagger/").Handler(httpSwagger.Handler(
		httpSwagger.URL("http://localhost:1323/swagger/doc.json"), //The url pointing to API definition
		httpSwagger.DeepLinking(true),
		httpSwagger.DocExpansion("none"),
		httpSwagger.DomID("swagger-ui"),
	)).Methods(http.MethodGet)

	log.Fatal(http.ListenAndServe(":1323", r))
}
```

### go-chi

Please refer to the [example folder](example)

[embedmd]:# (example/go-chi/main.go go)
```go
package main

import (
	"log"
	"net/http"

	"github.com/go-chi/chi"
	_ "github.com/venosm/http-swagger/example/go-chi/docs" // docs is generated by Swag CLI, you have to import it.
	httpSwagger "github.com/venosm/http-swagger"
)

// @title Swagger Example API
// @version 1.0
// @description This is a sample server Petstore server.
// @termsOfService http://swagger.io/terms/

// @contact.name API Support
// @contact.url http://www.swagger.io/support
// @contact.email support@swagger.io

// @license.name Apache 2.0
// @license.url http://www.apache.org/licenses/LICENSE-2.0.html

// @host petstore.swagger.io
// @BasePath /v2
func main() {
	r := chi.NewRouter()

	r.Get("/swagger/*", httpSwagger.Handler(
		httpSwagger.URL("http://localhost:1323/swagger/doc.json"), //The url pointing to API definition
	))

	log.Fatal(http.ListenAndServe(":1323", r))
}
```

### OpenAPI 3.0 with go-chi

Please refer to the [example folder](example)

[embedmd]:# (example/openapi3-go-chi/main.go go)
```go
package main

import (
	"log"
	"net/http"

	"github.com/go-chi/chi/v5"
	_ "github.com/venosm/http-swagger/example/openapi3-go-chi/docs" // docs is generated by Swag CLI, you have to import it.
	httpSwagger "github.com/venosm/http-swagger"
)

// @title OpenAPI 3.0 Example API
// @version 1.0.0
// @description This is a sample server demonstrating OpenAPI 3.0 support.
// @termsOfService http://swagger.io/terms/

// @contact.name API Support
// @contact.url http://www.swagger.io/support
// @contact.email support@swagger.io

// @license.name Apache 2.0
// @license.url http://www.apache.org/licenses/LICENSE-2.0.html

// @host petstore.swagger.io
// @BasePath /v3
func main() {
	r := chi.NewRouter()

	r.Get("/swagger/*", httpSwagger.Handler(
		httpSwagger.URL("http://localhost:1323/swagger/openapi.json"), // The url pointing to API definition
		httpSwagger.TryItOutEnabled(true),                            // Enable "Try it out" for OpenAPI 3.0
		httpSwagger.DefaultModelsExpandDepth(1),
		httpSwagger.ShowExtensions(true),
	))

	log.Println("Server starting on :1323")
	log.Fatal(http.ListenAndServe(":1323", r))
}
```

4. Run it, and browse to http://localhost:1323/swagger/index.html, you can see Swagger 3.0 Api documents.

![swagger_index.html](https://user-images.githubusercontent.com/8943871/36250587-40834072-1279-11e8-8bb7-02a2e2fdd7a7.png)

## Configuration

You can configure Swagger using different configuration options

```go
func Handler(c ...Config) http.HandlerFunc
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| URL | string | "doc.json" | URL pointing to the API definition |
| DocExpansion | string | "list" | Controls the default expansion setting for the operations and tags |
| DomID | string | "#swagger-ui" | Controls the default domID |
| InstanceName | string | "swagger" | The instance name of the swagger document |
| DeepLinking | bool | true | Controls whether deep linking is enabled |
| PersistAuthorization | bool | false | Controls whether authorization data is persisted |

## Contributing

This project is based on the original work from [swaggo/http-swagger](https://github.com/swaggo/http-swagger). We appreciate the excellent foundation provided by the original maintainers.

## License

[MIT](LICENSE)
